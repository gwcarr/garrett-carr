---
title: "02 Data Story"
output: 
  github_document:
    pandoc_args: --webtex
---

## Initial Model

The variables available to me are:

* ID
* Age
* Experience
* Income
* ZIP Code
* Family
* CCAvg
* Education
* Mortgage
* Personal Loan
* Securities Account
* CD Account
* Online
* CreditCard

ID is just a simple row index, so that will obviously be excluded.

##### Variables
* Age
* Experience
* Income
* ZIP Code
* Family
* CCAvg
* Education
* Mortgage
* Securities Account
* CD Account
* Online
* CreditCard

##### Response
* Personal Loan

```{r Setup, echo=FALSE}
library(dagitty)
library(rethinking)
library(cmdstanr)
library(readr)
data <-
  read_csv(
    './Project/Data/Bank_Personal_Loan_Modelling.csv',
    trim_ws = TRUE,
    col_types = "dddddfdfdlllll"
  )
```
### Creating The Model

I will initially set the priors as flat. We will start with a small number of predictors.

```{r Intial Modle Priors, eval=FALSE}
loan ~ binomial(1, p) # Binomial distribution of likelihood to accept the personal loan
logit(p) = beta_age  + beta_income + beta_ccavg  # logit model for acceptance of loan likelihood
beta_age ~ normal(0, 0.01 )          # Effect of Age on loan acceptance 
beta_income ~ normal(0, 0.01)        # Effect of income
beta_ccavg ~ normal(0, 0.01)         # Effect of average credit card balance
```

### Running the Model
Just using the intial model, to see what the output looks like

```{r Running the Initial Model}
# Create data list
loan_list <- list(
  loan = data$`Personal Loan`,
  age = data$Age,
  income = data$Income,
  ccavg = data$CCAvg
)

# Fitting the Initial Model
fit01 <- ulam(
  alist(
    loan ~ dbinom(1, p),
    logit(p) <- beta_age * age + beta_inc * income + beta_cc * ccavg,
    beta_age ~ dnorm(0, 0.5),
    beta_inc ~ dnorm(0, 1),
    beta_cc ~ dnorm(0, 1.5)
  ),
  data = loan_list,
  log_lik = TRUE,
  chains = 4,
  cores = 4,
  cmdstan = TRUE
)
```
Stan didn't like that very much, probably because the priors are trash, and not very informative.



